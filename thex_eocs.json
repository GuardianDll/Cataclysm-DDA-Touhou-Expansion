[
  {
    "id": "thex_everything_eoc",
    "type": "effect_on_condition",
    "eoc_type": "SCENARIO_SPECIFIC",
    "effect": [
      { "u_add_var": "var_wind_blessing_dex", "type": "number", "context": "wind_priestess_charm", "value": "0" },
      { "u_add_var": "var_wind_blessing_int", "type": "number", "context": "wind_priestess_charm", "value": "0" },
      { "u_add_var": "var_wind_blessing_per", "type": "number", "context": "wind_priestess_charm", "value": "0" },
      { "u_add_var": "var_wind_blessing_str", "type": "number", "context": "wind_priestess_charm", "value": "0" },
      { "run_eocs": [ "daily_randomization_12_eoc" ] }
    ]
  },
  {
    "id": "daily_randomization_12_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "night_parade_proc", "=", "rand(99)" ] },
      { "math": [ "silence_hour_proc", "=", "rand(99)" ] },
      { "math": [ "silence_hour_second", "=", "rand(86399)" ] },
      { "math": [ "scarlet_weather_proc", "=", "rand(99)" ] },
      { "math": [ "weather_blood_rain_proc", "=", "rand(99)" ] },
      { "math": [ "weather_carnian_proc", "=", "rand(99)" ] },
      { "queue_eocs": [ "daily_randomization_24_eoc" ], "time_in_future": "12 h" }
    ],
    "//": "Runs a single time after the start of the game (12:00:00)"
  },
  {
    "id": "daily_randomization_24_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "night_parade_proc", "=", "rand(99)" ] },
      { "math": [ "silence_hour_proc", "=", "rand(99)" ] },
      { "math": [ "silence_hour_second", "=", "rand(86399)" ] },
      { "math": [ "scarlet_weather_proc", "=", "rand(99)" ] },
      { "math": [ "weather_blood_rain_proc", "=", "rand(99)" ] },
      { "math": [ "weather_carnian_proc", "=", "rand(99)" ] },
      { "math": [ "weather_carnian_active", "=", "0" ] },
      { "queue_eocs": [ "daily_randomization_24_eoc" ], "time_in_future": "24 h" }
    ],
    "//": "Re-rolls daily at 00:00:00, for use in special events",
    "//WIP": "Carnian weather is disabled, it requires weather_carnian_active >= 1"
  },
  {
    "id": "guevaudan_attacked_melee_eoc",
    "type": "effect_on_condition",
    "eoc_type": "EVENT",
    "required_event": "character_melee_attacks_monster",
    "condition": { "compare_string": [ "mon_gevaudan", { "context_val": "victim_type" } ] },
    "effect": [ 
      { "npc_location_variable": { "global_val": "var_gevaudan_loc" } },
      { "run_eoc_with": "guevaudan_attacked_check_eoc", "beta_loc": { "global_val": "var_gevaudan_loc" } }
    ],
    "//": "These are WIP eocs, given I don't know how to track the dmg mon_gevaudan receives with silver-based materials",
    "//2": "This alternative instead prevents it from self-healing if damaged by a silver-based weapon",
    "//3": "Probably keep still after I figure out"
  },
  {
    "id": "guevaudan_attacked_ranged_eoc",
    "type": "effect_on_condition",
    "eoc_type": "EVENT",
    "required_event": "character_ranged_attacks_character",
    "condition": { "compare_string": [ "mon_gevaudan", { "context_val": "victim_type" } ] },
    "effect": [ 
      { "npc_location_variable": { "global_val": "var_gevaudan_loc" } },
      { "run_eoc_with": "guevaudan_attacked_check_eoc", "beta_loc": { "global_val": "var_gevaudan_loc" } }
    ]
  },
  {
    "id": "guevaudan_attacked_check_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "npc_add_effect": "gevaudan_noregen", "duration": "31 s" }
    ]
  },
  
  {
    "id": "impurity_eoc",
    "type": "effect_on_condition",
    "recurrence": "20 m",
    "effect": [
      {
        "run_eocs": [
          {
            "id": "impurity_extremelylow",
            "condition": { "math": [ "u_vitamin('impurity')", "<", "0" ] },
            "effect": [ { "math": [ "var_impurity", "=", "0" ] } ]
          },
          {
            "id": "impurity_verylow",
            "condition": {
              "and": [
                { "math": [ "u_vitamin('impurity')", ">=", "1" ] },
                { "math": [ "u_vitamin('impurity')", "<=", "144" ] }
              ]
            },
            "effect": [ { "math": [ "var_impurity", "=", "1" ] } ]
          },
          {
            "id": "impurity_low",
            "condition": {
              "and": [
                { "math": [ "u_vitamin('impurity')", ">=", "145" ] },
                { "math": [ "u_vitamin('impurity')", "<=", "504" ] }
              ]
            },
            "effect": [ { "math": [ "var_impurity", "=", "2" ] } ]
          },
          {
            "id": "impurity_high",
            "condition": { "math": [ "u_vitamin('impurity')", ">=", "505" ] },
            "effect": [ { "math": [ "var_impurity", "=", "3" ] } ]
          }
        ]
      }
    ],
    "//": "1 impurity every 20 min equals 72 impurity per day or 504 in 7 days, and that's not considering consuming Earthly stuff during that period of time",
    "//2": "Boundaries for each impure tier: -48 - 0 h (extremely low), 0 - 48 h (verylow), 2 - 7 days (low), >7 days (high)",
    "//3": "Impurity tiers are named: Pure, Slight impurity, Impure, Impure (2) "
  },
  {
    "id": "purifying_rain_eoc",
    "type": "effect_on_condition",
    "recurrence": [ "87 d", "88 d" ],
    "condition": { "math": [ "purifying_rain_proc", "<=", "1" ] },
    "global": true,
    "effect": [ 
      { "run_eocs": [ "purifying_rain_CANCEL_PORTAL_STORM_eoc" ] },
      { "math": [ "purifying_rain_proc", "+=", "1" ] }, 
      {
        "queue_eocs": [
          {
            "id": "purifying_rain_disable_eoc",
            "effect": [ 
              { "math": [ "purifying_rain_proc", "+=", "1" ] }, 
              { "math": [ "purifying_rain_ended", "=", "1" ] } 
            ]
          }
        ],
        "time_in_future": "2 d 23 h 1 s"
      }
    ],
    "//": "Do note that if the var is set to 0 while the weather is still running, it seems to immediately deactivate it",
    "//2": "The weather_type should only run once, and always end at the 90 day mark. This is for lore purposes, linked to the second wave of LDC faction"
  },
  {
    "id": "purifying_rain_CANCEL_PORTAL_STORM_eoc",
    "type": "effect_on_condition",
    "global": true,
    "//": "This sets up all the variables for the end of a portal storm.",
    "effect": [
      { "math": [ "cause_portal_storm", "=", "0" ] },
      { "math": [ "cause_early_portal_storm", "=", "0" ] },
      { "math": [ "portal_dungeon_slow_strength", "=", "0" ] },
      { "math": [ "portal_dungeon_carry_strength", "=", "0" ] },
      { "math": [ "portal_dungeon_reflect_strength", "=", "0" ] },
      { "u_add_var": "global_portal_storms_u_witnessed_portal_storm", "value": "yes" },
      { "run_eocs": [ "EOC_PORTAL_STORM_DUNGEON_EXIT" ] },
      { "remove_active_mission": "MISSION_INVESTIGATE_PORTAL_DUNGEON" },
      { "remove_active_mission": "MISSION_INVESTIGATE_PORTAL_STORM_CENTER" },
      { "alter_timed_events": "portal_dungeon_entrance" },
      { "math": [ "talked_to_storm", "=", "0" ] }
    ],
    "//2": "Should be exactly the same as EOC_CANCEL_PORTAL_STORM except no condition, no next_weather , no u_message , EOC_WORSEN_PORTAL_STORM is not run, no u_counter_portal_storm_counter increase, and no trigger_event "
  }
]
